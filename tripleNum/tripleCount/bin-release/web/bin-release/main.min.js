var CellItemrenderer=function(e){function t(){e.call(this),this.tween=egret.Tween.get(this),this.touchEnabled=!1,this.touchChildren=!1}__extends(t,e);var i=(__define,t),r=i.prototype;return r.setInSelect=function(e){e?(null==this.shp&&(this.shp=new egret.Shape,this.shp.graphics.lineStyle(2,16776960),this.shp.graphics.lineTo(75,0),this.shp.graphics.lineTo(75,75),this.shp.graphics.lineTo(0,75),this.shp.graphics.lineTo(0,0),this.shp.graphics.endFill),this.addChild(this.shp),this.startTween()):(this.endTween(),null!=this.shp&&null!=this.shp.parent&&this.shp.parent.removeChild(this.shp))},r.startTween=function(){egret.Tween.get(this.cellBp).to({scaleX:1.1,scaleY:1.1},500).wait(100).to({scaleX:1,scaleY:1},500).wait(100).call(this.startTween,this)},r.endTween=function(){this.scaleX=1,this.scaleY=1,this.tween.pause()},r.setType=function(e,t){if(this.cellType!=e||this.cellValue!=t){null!=this.cellBp&&null!=this.cellBp.parent&&this.cellBp.parent.removeChild(this.cellBp),this.cellType=e,this.cellValue=t;var i="";switch(this.cellType){case 1:i="plant";break;case 2:i="animal";break;case 3:i="bianbian";break;case 4:i="moneyBag";break;case 5:i="potion"}switch(this.cellValue){case 0:break;case 1:i+="1";break;case 2:i+="2";break;case 3:i+="3";break;case 4:i+="4";break;case 5:i+="5";break;case 6:i+="6"}i+="_png",this.cellBp=this.createBitmapByName(i),this.cellBp.x=2.5,this.cellBp.y=2.5,this.addChild(this.cellBp)}},r.upGrade=function(){return 1==this.cellType&&3==this.cellValue?null:2==this.cellType&&6==this.cellValue?null:(this.setType(this.cellType,this.cellValue+1),this)},r.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(egret.DisplayObjectContainer);egret.registerClass(CellItemrenderer,"CellItemrenderer");var GameView=function(e){function t(){e.call(this),this.cancelArr=[],this.tempArr=[];var t=this.createBitmapByName("bg_png");this.addChild(t),this.createContainer=new egret.Sprite,this.createContainer.x=171,this.createContainer.y=148,this.addChild(this.createContainer);var i=this.createBitmapByName("createPot_png");this.createContainer.addChild(i),this.gameContainer=new egret.Sprite,this.gameContainer.x=14.5,this.gameContainer.y=256,this.addChild(this.gameContainer);var r=this.createBitmapByName("cells_png");this.gameContainer.addChild(r),this.gameContainer.touchEnabled=!0,this.gameContainer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.addMap,this),this.storeContainer=new egret.Sprite,this.gameContainer.addChild(this.storeContainer);var l=this.createBitmapByName("bottom_png");l.x=2,l.y=33,this.storeContainer.addChild(l);var s=this.createBitmapByName("top_png");s.x=2,s.y=4,this.storeContainer.addChild(s),this.initView()}__extends(t,e);var i=(__define,t),r=i.prototype;return r.clearReady=function(){null!=this.readyCell&&(null!=this.readyCell&&null!=this.readyCell.parent&&this.readyCell.parent.removeChild(this.readyCell),this.readyCell.setInSelect(!1),this.readyCell=null)},r.addMap=function(e){var t=Math.floor(e.localX/75),i=Math.floor(e.localY/75);0==t&&0==i?this.cashInStore():null!=this.walls[t][i]?null!=this.readyCell&&this.readyCell.col==t&&this.readyCell.row==i&&(this.clearReady(),this.create.col=t,this.create.row=i,this.putToWall(this.create),this.tripleCancel(this.create),this.create=null,this.createNewCell()):null!=this.readyCell?(this.walls[this.readyCell.col][this.readyCell.row]=null,this.readyCell.col=t,this.readyCell.row=i,this.putToWall(this.readyCell)):(this.readyCell=new CellItemrenderer,this.readyCell.setType(this.create.cellType,this.create.cellValue),this.readyCell.col=t,this.readyCell.row=i,this.readyCell.setInSelect(!0),this.putToWall(this.readyCell))},r.tripleCancel=function(e){for(this.cancelArr=[],this.tempArr=[],this.tempArr.push(e);this.tempArr.length>0;){var e=this.tempArr.shift();this.cancelArr.push(e),e.col-1>=0&&null!=this.walls[e.col-1][e.row]&&this.checkSame(e,this.walls[e.col-1][e.row])&&!this.checkInCancel(this.walls[e.col-1][e.row])&&this.tempArr.push(this.walls[e.col-1][e.row]),e.col+1<6&&null!=this.walls[e.col+1][e.row]&&this.checkSame(e,this.walls[e.col+1][e.row])&&!this.checkInCancel(this.walls[e.col+1][e.row])&&this.tempArr.push(this.walls[e.col+1][e.row]),e.row-1>=0&&null!=this.walls[e.col][e.row-1]&&this.checkSame(e,this.walls[e.col][e.row-1])&&!this.checkInCancel(this.walls[e.col][e.row-1])&&this.tempArr.push(this.walls[e.col][e.row-1]),e.row+1<6&&null!=this.walls[e.col][e.row+1]&&this.checkSame(e,this.walls[e.col][e.row+1])&&!this.checkInCancel(this.walls[e.col][e.row+1])&&this.tempArr.push(this.walls[e.col][e.row+1])}if(this.cancelArr.length<3)return void(this.cancelArr=[]);var t=this.cancelArr.shift(),i=t.col,r=t.row;for(t=t.upGrade(),null==t&&null!=this.walls[i][r].parent&&this.walls[i][r].parent.removeChild(this.walls[i][r]),this.walls[i][r]=t;this.cancelArr.length>0;){var l=this.cancelArr.shift();null!=l.parent&&l.parent.removeChild(l),this.walls[l.col][l.row]=null}null!=t&&this.tripleCancel(t)},r.checkSame=function(e,t){return 0==t.row&&0==t.col||e.cellType!=t.cellType||e.cellValue!=t.cellValue?!1:!0},r.checkInCancel=function(e){for(var t=0;t<this.cancelArr.length;t++)if(e==this.cancelArr[t])return!0;return!1},r.createNewCell=function(){null==this.create&&(this.create=this.createRandomCell()),this.create.x=30,this.create.y=-20,this.createContainer.addChild(this.create)},r.cashInStore=function(){if(this.clearReady(),null==this.store)this.store=this.create,this.create=null;else{var e=this.store;this.store=this.create,this.create=e}this.createNewCell(),this.store.x=0,this.store.y=0,this.storeContainer.addChild(this.store)},r.initView=function(){this.walls=[];for(var e=0;6>e;e++)this.walls.push([null,null,null,null,null,null]);this.createMap(),this.createNewCell()},r.putToWall=function(e){this.walls[e.col][e.row]=e,e.x=75*e.col,e.y=75*e.row,(0!=e.row||0!=e.col)&&this.gameContainer.addChild(e)},r.createMap=function(){for(var e=Math.round(8*Math.random())+5,t=this.createPositionArr(),i=0;e>i;i++){var r=this.createRandomCell(),l=Math.round(Math.random()*t.length);l>=t.length&&(l=0);var s=t.splice(l,1)[0];r.col=Math.floor(s/6),r.row=s%6,this.putToWall(r)}},r.createPositionArr=function(){for(var e=[],t=0;6>t;t++)for(var i=0;6>i;i++)if(null==this.walls[t][i]){if(0==t&&0==i)continue;e.push(6*t+i)}return e},r.createRandomCell=function(){var e,t,i=new CellItemrenderer,r=Math.round(20*Math.random());e=r%3?1:2;var l=Math.round(1e3*Math.random());return l%=100,t=70>l?1:90>l?2:3,i.setType(e,t),i},r.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(egret.DisplayObjectContainer);egret.registerClass(GameView,"GameView");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.completeGroupNum=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/resource.json","resource/")},r.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload"),RES.loadGroup("triple")},r.onResourceLoadComplete=function(e){this.completeGroupNum++,2==this.completeGroupNum&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},r.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},r.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},r.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},r.createGameScene=function(){null==this.gameView&&(this.gameView=new GameView),this.addChild(this.gameView)},r.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");